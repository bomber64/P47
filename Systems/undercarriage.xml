<?xml version="1.0"?>


<system name="undercarriage">

	<property type="bool" value="1"> gear/switch </property>
 	<property type="double" value="1"> gear/damage</property>
		
	<channel name="gear">
	
        <!-- Gears Raising or Lowering -->         
			<switch name="gear/raise-or-lower">
				<default value="gear/speed-raise"/>
				<test value="gear/speed-lower">
					gear/switch EQ 1
				</test>			
			</switch>
			
			<switch name="gear/emergency_speed">
				<default value="0"/>
				<test logic="AND" value="0.5">
					hydraulic/emergency_pressure GT 0
					hydraulic/emergency_pressure LT 1
				</test>				
			</switch>
			
		<!-- Engine Driven Hydraulics OK -->
			<switch name="gear/hydraulic-pressure">
				<default value="hydraulic/pressure"/>
				<test value="1"> <!-- less than 4 secs into the sim -->
					/fdm/jsbsim/sim-time-sec LT 4
				</test>		 			
			</switch>			
			
			<fcs_function name="gear/speed">
				<function>
					<sum>
						<product>
							<property>gear/raise-or-lower</property>
							<property>gear/damage</property>
							<property>gear/hydraulic-pressure</property>
						</product>
						<product>
							<property>gear/emergency_speed</property>
							<property>hydraulic/Co2-damage</property>
						</product>
					</sum>
				</function>
			</fcs_function>			
							
        <!-- Motion trigger stops --> 			
			<switch name="gear/limit-stop">
				<default value="0"/>
				<test logic="AND" value="1">  <!-- Hi Limit Stop -->
					gear/lowered LE 0
					gear/speed LE 0
				</test>
				<test logic="AND" value="2">  <!-- Lo Limit Stop -->
					gear/lowered GE 1
					gear/speed GE 0
				</test>			
			</switch>
			
        <!-- Gear Motion -->
			<integrator name="gear/lowered">
				<input>gear/speed</input>
				<trigger>gear/limit-stop</trigger>
				<c1>1</c1>
				<clipto>
					<min>0</min>
					<max>1</max>
				</clipto>			
				<output>gear/gear-pos-norm</output>
			</integrator>
			
	    <!-- Gear Weight Movement -->      
			<fcs_function name="gear/x">
				<function>
					<product>
						<table>
							<independentVar>gear/gear-pos-norm</independentVar>
							<tableData>                  
								0      1
								1      1.2                
							</tableData>
						</table>
						<product>
							<value> 12 </value> <!-- FT to Inches -->
							<property>T4T/structure/left-up/x</property>
						</product>
					</product>
				</function>
				<output>/fdm/jsbsim/inertia/pointmass-location-X-inches[35]</output>
				<output>/fdm/jsbsim/inertia/pointmass-location-X-inches[36]</output>  			
			</fcs_function>
			<fcs_function name="gear/y">
				<function>
					<product>
						<table>
							<independentVar>gear/gear-pos-norm</independentVar>
							<tableData>                  
								0      1
								1      0.644                
							</tableData>
						</table>
						<product>
							<value> 12 </value> <!-- FT to Inches -->
							<property>T4T/structure/left-up/y</property>
						</product>
					</product>
				</function>
				<output>/fdm/jsbsim/inertia/pointmass-location-Y-inches[35]</output>		
			</fcs_function>
			<fcs_function name="gear/y">
				<function>
					<product>
						<table>
							<independentVar>gear/gear-pos-norm</independentVar>
							<tableData>                  
								0      1
								1      0.644                
							</tableData>
						</table>
						<product>
							<value> 12 </value> <!-- FT to Inches -->
							<property>T4T/structure/right-up/y</property>
						</product>
					</product>
				</function>
				<output>/fdm/jsbsim/inertia/pointmass-location-Y-inches[36]</output>  			
			</fcs_function>
			<fcs_function name="gear/z">
				<function>
					<product>
						<table>
							<independentVar>gear/gear-pos-norm</independentVar>
							<tableData>                  
								0      1
								1      2.024               
							</tableData>
						</table>
						<product>
							<value> 12 </value> <!-- FT to Inches -->
							<property>T4T/structure/left-up/z</property>
						</product>
					</product>
				</function>
				<output>/fdm/jsbsim/inertia/pointmass-location-Z-inches[35]</output>
				<output>/fdm/jsbsim/inertia/pointmass-location-Z-inches[36]</output>  			
			</fcs_function>
		
	</channel>

</system>